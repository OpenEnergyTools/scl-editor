{"version":3,"file":"foundation.js","sources":["../../../../template/templates/foundation.ts"],"sourcesContent":["/* eslint-disable no-await-in-loop */\n/* eslint-disable no-nested-ternary */\n/* eslint-disable no-shadow */\n/* eslint-disable no-continue */\n/* eslint-disable no-use-before-define */\nimport { IssueDetail } from '../../foundation/utils.js';\nimport { dAValidator } from './dabda.js';\nimport { dATypeValidator } from './datype.js';\nimport { dOValidator } from './dosdo.js';\nimport { dOTypeValidator } from './dotype.js';\nimport { lNodeTypeValidator } from './lnodetype.js';\n\nexport const iec6185074 = fetch(\n  new URL('./IEC_61850-7-4_2007B3.nsd', import.meta.url)\n)\n  .then(response => response.text())\n  .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\nexport const iec6185073 = fetch(\n  new URL('./IEC_61850-7-3_2007B3.nsd', import.meta.url)\n)\n  .then(response => response.text())\n  .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\nexport const iec6185072 = fetch(\n  new URL('./IEC_61850-7-2_2007B3.nsd', import.meta.url)\n)\n  .then(response => response.text())\n  .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\nexport const iec6185081 = fetch(\n  new URL('./IEC_61850-8-1_2003A2.nsd', import.meta.url)\n)\n  .then(response => response.text())\n  .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\nexport const serviceCDCs = [\n  'SPC',\n  'DPC',\n  'INC',\n  'ENC',\n  'BSC',\n  'ISC',\n  'APC',\n  'BAC',\n];\n\nexport function isTypeMissing(element: Element): boolean {\n  const { tagName } = element;\n  const isTypeMandatory =\n    tagName === 'DO' ||\n    tagName === 'SDO' ||\n    ((tagName === 'DA' || tagName === 'BDA') &&\n      (element.getAttribute('bType') === 'Enum' ||\n        element.getAttribute('bType') === 'Struct'));\n\n  const isTypeMissing = !element.getAttribute('type');\n\n  return isTypeMandatory && isTypeMissing;\n}\n\nexport function getTypeChild(element: Element): Element | null | undefined {\n  const isStruct = element.getAttribute('bType') === 'Struct';\n  const isEnum = element.getAttribute('bType') === 'Enum';\n  const isDo = element.tagName === 'DO' || element.tagName === 'SDO';\n\n  const referenceTag = isDo\n    ? 'DOType'\n    : isStruct || isEnum\n    ? isStruct\n      ? 'DAType'\n      : 'EnumType'\n    : null;\n\n  if (!referenceTag) return undefined;\n\n  return (\n    element\n      .closest('DataTypeTemplates')\n      ?.querySelector(\n        `${referenceTag}[id=\"${element.getAttribute('type')}\"]`\n      ) ?? null\n  );\n}\n\nexport function getAdjacentClass(nsd: XMLDocument, base: string): Element[] {\n  if (base === '') return [];\n  const adjacents = getAdjacentClass(\n    nsd,\n    nsd\n      .querySelector(`LNClass[name=\"${base}\"], AbstractLNClass[name=\"${base}\"]`)\n      ?.getAttribute('base') ?? ''\n  );\n  return Array.from(\n    nsd.querySelectorAll(\n      `LNClass[name=\"${base}\"], AbstractLNClass[name=\"${base}\"]`\n    )\n  ).concat(adjacents);\n}\n\nexport async function validateChildren(\n  element: Element\n): Promise<IssueDetail[]> {\n  const issues: IssueDetail[] = [];\n\n  const children = Array.from(element.children);\n\n  for (const child of children) {\n    const validator = tagValidator[child.tagName];\n    if (!validator) continue;\n\n    const childIssues = await validator(child);\n    if (childIssues.length)\n      for (const childIssue of childIssues) issues.push(childIssue);\n  }\n\n  return issues;\n}\n\ntype ValidationFunction = (e: Element, r?: Element) => Promise<IssueDetail[]>;\n\nexport const tagValidator: Partial<Record<string, ValidationFunction>> = {\n  LNodeType: lNodeTypeValidator,\n  DOType: dOTypeValidator,\n  DAType: dATypeValidator,\n  DO: dOValidator,\n  SDO: dOValidator,\n  DA: dAValidator,\n  BDA: dAValidator,\n};\n"],"names":[],"mappings":"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"}